<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Algoritmo de Johnson - Editor</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <style>
        :root { --primary-blue: #2c3e50; --accent-blue: #3498db; }
        body { margin: 0; font-family: Arial, sans-serif; display: grid; grid-template-columns: 250px 1fr 300px; height: 100vh; overflow: hidden; }

        /* Sidebar Izquierda */
        .sidebar { background: var(--primary-blue); color: white; padding: 20px; border-right: 1px solid #34495e; }
        .sidebar a { color: #bdc3c7; text-decoration: none; display: block; padding: 10px 0; border-bottom: 1px solid #3e5871; }
        .sidebar a.active { color: white; font-weight: bold; }

        /* Área de Diseño (Centro) */
        #design-area { background: white; position: relative; border-right: 1px solid #ddd; }
        #network-jhonson { width: 100%; height: 100%; }

        /* Panel de Opciones (Derecha) */
        .options-panel { background: #f8f9fa; padding: 20px; overflow-y: auto; }
        h3 { font-size: 1.1em; color: var(--primary-blue); border-bottom: 2px solid var(--accent-blue); padding-bottom: 5px; }
        .input-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-top: 5px; }
        button { background: var(--accent-blue); color: white; border: none; padding: 10px; margin-top: 10px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        button:hover { background: #2980b9; }

        /* Info del Nodo abajo */
        #node-info { margin-top: 20px; font-size: 0.9em; background: #fff; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2>Menú</h2>
        <a href="index.html">Página Inicial</a>
        <a href="Principal.html">Grafos Básicos</a>
        <a href="#" class="active">Algoritmo Johnson</a>
        <div style="margin-top: auto; padding-top: 100px;">Contacto</div>
    </nav>

    <main id="design-area">
        <div id="network-jhonson"></div>
    </main>

    <aside class="options-panel">
        <h3>Controles de Johnson</h3>
        <div class="input-group">
            <label>Nombre del Nodo:</label>
            <input type="text" id="node-id" placeholder="Ej: 1">
            <button onclick="addJhonsonNode()">Crear Nodo</button>
        </div>
        <div class="input-group">
            <label>Conectar (Origen > Destino):</label>
            <input type="text" id="edge-from" placeholder="ID Origen">
            <input type="text" id="edge-to" placeholder="ID Destino">
            <input type="number" id="edge-weight" placeholder="Peso (Duración)">
            <button onclick="addJhonsonEdge()">Conectar Actividad</button>
        </div>
        <button onclick="calculateJohnson()" style="background: #27ae60; width: 100%;">Calcular Algoritmo</button>
        
        <div id="node-info">
            <strong>Instrucciones:</strong><br>
            El círculo dividido muestra:<br>
            - Arriba: ID Nodo<br>
            - Abajo Izq: Tiempo Temprano (Suma)<br>
            - Abajo Der: Tiempo Tardío (Resta)
        </div>
    </aside>

    <script>
        // Configuración de Datos
        let nodes = new vis.DataSet([]);
        let edges = new vis.DataSet([]);
        let container = document.getElementById('network-jhonson');

        // Renderizado personalizado del nodo circular dividido
        const options = {
            physics: false,
            nodes: {
                shape: 'custom',
                ctxRenderer: ({ ctx, x, y, state: { selected, hover }, style, label }) => {
                    const r = 30;
                    ctx.beginPath();
                    ctx.arc(x, y, r, 0, 2 * Math.PI, false);
                    ctx.fillStyle = "white";
                    ctx.fill();
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = selected ? "#e74c3c" : "#2c3e50";
                    ctx.stroke();

                    // Línea Horizontal
                    ctx.moveTo(x - r, y);
                    ctx.lineTo(x + r, y);
                    // Línea Vertical abajo
                    ctx.moveTo(x, y);
                    ctx.lineTo(x, y + r);
                    ctx.stroke();

                    // Textos (ID, Suma, Resta)
                    ctx.fillStyle = "black";
                    ctx.font = "bold 12px Arial";
                    ctx.textAlign = "center";
                    
                    // ID (Arriba)
                    ctx.fillText(label || "", x, y - 10);
                    
                    // Valores Johnson (Suma/Resta)
                    const nodeData = nodes.get(label);
                    const early = nodeData?.early ?? "-";
                    const late = nodeData?.late ?? "-";
                    
                    ctx.font = "10px Arial";
                    ctx.fillText(early, x - r/2, y + 18); // Lado Suma
                    ctx.fillText(late, x + r/2, y + 18);  // Lado Resta
                    
                    return {
                        drawNode() {},
                        drawExternalLabel() {},
                        nodeDimensions: { width: 2*r, height: 2*r }
                    };
                }
            },
            edges: {
                arrows: 'to',
                color: '#2c3e50',
                font: { align: 'top' }
            }
        };

        let network = new vis.Network(container, { nodes, edges }, options);

        function addJhonsonNode() {
            const id = document.getElementById('node-id').value;
            if(!id) return;
            nodes.add({ id: id, label: id, early: 0, late: 0 });
            document.getElementById('node-id').value = "";
        }

        function addJhonsonEdge() {
            const from = document.getElementById('edge-from').value;
            const to = document.getElementById('edge-to').value;
            const weight = parseInt(document.getElementById('edge-weight').value);
            if(!nodes.get(from) || !nodes.get(to)) return alert("Nodos inválidos");
            edges.add({ from, to, label: String(weight), weight });
        }

        function calculateJohnson() {
            let nodeList = nodes.getIds();
            let edgeList = edges.get();

            // 1. Paso Adelante (Early Times)
            nodeList.forEach(id => {
                let node = nodes.get(id);
                node.early = 0;
                nodes.update(node);
            });

            // Ordenación simple por flujo (asumiendo nodos numerados o topológicos)
            for(let i=0; i<nodeList.length; i++) {
                edgeList.forEach(edge => {
                    let u = nodes.get(edge.from);
                    let v = nodes.get(edge.to);
                    if(v.early < u.early + edge.weight) {
                        v.early = u.early + edge.weight;
                        nodes.update(v);
                    }
                });
            }

            // 2. Paso Atrás (Late Times)
            let maxEarly = Math.max(...nodes.get().map(n => n.early));
            nodeList.forEach(id => {
                let node = nodes.get(id);
                node.late = maxEarly;
                nodes.update(node);
            });

            for(let i=0; i<nodeList.length; i++) {
                edgeList.forEach(edge => {
                    let u = nodes.get(edge.from);
                    let v = nodes.get(edge.to);
                    if(u.late > v.late - edge.weight) {
                        u.late = v.late - edge.weight;
                        nodes.update(u);
                    }
                });
            }
            network.redraw(); // Forzar dibujado de los nuevos valores
        }
    </script>
</body>
</html>